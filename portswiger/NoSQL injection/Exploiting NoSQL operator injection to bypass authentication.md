# Exploiting NoSQL Operator Injection to Bypass Authentication

This guide provides a clear and organized solution to bypass authentication in a lab environment by exploiting NoSQL operator injection in a MongoDB-based application. The goal is to manipulate the login query to gain unauthorized access as an administrator user.

## Objective
Log in as the `admin` user by exploiting the NoSQL query vulnerability using MongoDB operators (`$regex` and `$ne`) in the login request.

## Prerequisites
- Access to Burp Suite with Proxy and Repeater modules.
- Initial valid credentials: `username: wiener`, `password: peter`.
- A web application vulnerable to NoSQL operator injection.

## Steps to Solve the Lab

### Step 1: Log in with Valid Credentials
1. Open Burp's browser and navigate to the application's login page.
2. Enter the credentials:
   - **Username**: `wiener`
   - **Password**: `peter`
3. Submit the login form to confirm successful authentication.

### Step 2: Capture the Login Request
1. In Burp Suite, go to **Proxy > HTTP history**.
2. Locate the `POST /login` request corresponding to the login action.
3. Right-click the request and select **Send to Repeater** for further testing.

### Step 3: Test NoSQL Operator Injection
Use Burp's Repeater to manipulate the `username` and `password` parameters and test for MongoDB operator injection vulnerabilities.

#### Test 1: Inject `$ne` Operator in Username
1. In the Repeater tab, modify the `username` parameter:
   - Change: `{"$ne":""}`
   - **Password**: `peter` (unchanged)
2. Send the request.
3. **Observation**: The login is successful, indicating that the `$ne` operator is processed by the server, bypassing the exact username match.

#### Test 2: Inject `$regex` Operator in Username
1. Change the `username` parameter to:
   - **Username**: `{"$regex":"wien.*"}`
   - **Password**: `peter` (unchanged)
2. Send the request.
3. **Observation**: The login succeeds, confirming that the `$regex` operator is also processed, allowing partial username matches.

#### Test 3: Inject `$ne` Operator in Both Fields
1. Update the parameters:
   - **Username**: `{"$ne":""}`
   - **Password**: `{"$ne":""}`
2. Send the request.
3. **Observation**: The response indicates an unexpected number of records returned, suggesting multiple users were matched due to the broad query.

#### Test 4: Target the Admin User
1. Modify the parameters to target the `admin` user:
   - **Username**: `{"$regex":"admin.*"}`
   - **Password**: `{"$ne":""}`
2. Send the request.
3. **Observation**: The login is successful, and the response indicates you are logged in as the `admin` user.

### Step 4: Access the Admin Account
1. Right-click the successful `POST /login` response in Repeater.
2. Select **Show response in browser** to obtain the session URL.
3. Copy the generated URL.
4. Paste the URL into Burp's browser to access the application as the `admin` user.

---

## Final Answer
The final payload used to bypass authentication and log in as the admin user is:

```json
{
  "username": {
    "$regex": "admin.*"
  },
  "password": {
    "$ne": ""
  }
}
```